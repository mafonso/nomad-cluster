{
  "variables": {
    "aws_access_key"    : "",
    "aws_secret_key"    : "",
    "aws_region"        : "eu-west-1",
    "aws_build_regions" : "eu-west-1",
    "aws_source_ami"    : "ami-9f388eec",
    "aws_instance_type" : "t2.micro",
    "aws_vpc_id"        : "",
    "aws_subnet_id"     : "",
    "ssh_username"      : "ubuntu",
    "ami_name_prefix"   : "consul"
  },
  "builders": [{
      "type"            : "amazon-ebs",
      "access_key"      : "{{user `aws_access_key`}}",
      "secret_key"      : "{{user `aws_secret_key`}}",
      "region"          : "{{user `aws_region`}}",
      "source_ami"      : "{{user `aws_source_ami`}}",
      "vpc_id"          : "{{user `aws_vpc_id`}}",
      "instance_type"   : "{{user `aws_instance_type`}}",
      "subnet_id"       : "{{user `aws_subnet_id`}}",
      "ssh_username"    : "{{user `ssh_username`}}",
      "ami_name"        : "{{user `ami_name_prefix`}}-{{timestamp}}",
      "ami_regions"     : "{{user `aws_build_regions`}}",
      "ssh_pty"         : "true"
    }],
  "provisioners": [
    {
      "type": "file",
      "source": ".",
      "destination": "/tmp/ansible"
    },
    {
      "type": "shell",
      "script": "install.sh"
    }
  ]
}